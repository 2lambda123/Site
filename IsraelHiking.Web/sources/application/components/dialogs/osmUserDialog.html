<div [dir]="resources.direction">
    <div md-dialog-title>
        <div fxLayout="row">
            <div fxFlex="90">
                <div fxLayout="row">
                    <div fxFlex="16">
                        <img [src]="userService.imageUrl" alt="" fxFill />
                    </div>
                    <div fxFlex="34">
                        <h3>{{userService.displayName}}</h3>
                        {{getRank().name}}
                    </div>
                    <div fxFlex>
                        <div fxLayout="column">
                            <h5>{{userService.changeSets}} {{resources.changes}} ({{getRankPercentage() | number : '1.0-0'}}%)</h5>
                            <md-progress-bar [color]="getProgessbarType()" [mode]="'determinate'" [value]="getRankPercentage()"></md-progress-bar>
                            <md-input-container hintLabel="{{resources.searchPlaceHolder}}">
                                <input mdInput type="text" [formControl]="searchTerm" placeholder="{{resources.search}}" />
                            </md-input-container>
                        </div>
                    </div>
                </div>
            </div>
            <div fxFlex>
                <button type="button" md-button md-dialog-close><i class="fa icon-close"></i></button>
            </div>
        </div>
    </div>
    <div md-dialog-content class="dialog-content-for-scroll">
        <md-tab-group [(selectedIndex)]="state.selectedTabIndex" [dynamicHeight]="'true'" (selectChange)="setSelectedTab()">
            <md-tab label="{{resources.myTraces}}">
                <div fxLayout="row">
                    <div fxFlex>
                        <label fxFlex>
                            <button fxFill md-button tye="button" angulartics2On="click" angularticsCategory="OSM" angularticsEvent="Upload OSM trace"><i class="fa icon-folder-open fa-lg"></i> {{resources.uploadFileToOsm}}</button>
                            <input type="file" (change)="uploadToOsm(file)" [(ngModel)]="file" [style.display]="'none'" />
                        </label>
                    </div>
                </div>
                <br />
                <div *ngFor="let trace of filteredTraces">
                    <div fxLayout="row">
                        <div fxFlex="33">
                            <img [src]="trace.imageUrl" alt="" fxFill />
                        </div>
                        <div fxFlex>
                            <div fxLayout="row">
                                <div fxFlex="75">
                                    <a href="{{trace.url}}" target="_blank" class="chrome-wordwrap-fix">{{trace.fileName}}</a><br />
                                    {{trace.description}}<br />
                                    {{trace.date | date:'dd/MM/yyyy'}}
                                </div>
                                <div fxFlex>
                                    <div fxLayout="column" fxLayoutAlign="space-between stretch">
                                        <button md-button md-dialog-close (click)="showTrace(trace)" mdTooltip="{{resources.view}}" mdTooltipPosition="before" angulartics2On="click" angularticsCategory="OSM" angularticsEvent="View OSM trace"><i class="fa icon-eye"></i></button>
                                        <button md-button md-dialog-close (click)="editTrace(trace)" mdTooltip="{{resources.edit}}" mdTooltipPosition="before" angulartics2On="click" angularticsCategory="OSM" angularticsEvent="Edit OSM trace"><i class="fa icon-pencil"></i></button>
                                        <button md-button (click)="editInOsm(trace)" mdTooltip="{{resources.editThisMapUsingOsm}}" mdTooltipPosition="before" angulartics2On="click" angularticsCategory="OSM" angularticsEvent="Edit OSM trace in OSM"><i class="fa icon-map-editing fa-lg"></i></button>
                                        <button md-button (click)="findUnmappedRoutes(trace)" mdTooltip="{{resources.findUnmappedRoutes}}" mdTooltipPosition="before" angulartics2On="click" angularticsCategory="OSM" angularticsEvent="Find unmapped trace parts"><i class="fa icon-plus"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <br />
                </div>
                <div class="cssload-loader" [hidden]="!userService.loading">
                    <div class="cssload-inner cssload-one"></div>
                    <div class="cssload-inner cssload-two"></div>
                    <div class="cssload-inner cssload-three"></div>
                </div>
                <p [hidden]="userService.traces.length != 0 || userService.loading">{{resources.noTraces}}</p>
            </md-tab>
            <md-tab label="{{resources.myShares}}">
                <div *ngFor="let siteUrl of filteredSiteUrls">
                    <div fxLayout="row">
                        <div fxFlex="33">
                            <img [src]="userService.getImageFromSiteUrlId(siteUrl)" fxFill />
                        </div>
                        <div fxFlex>
                            <div fxLayout="row">
                                <div fxFlex="75">
                                    <div [hidden]="editMode">
                                        <h4>{{siteUrl.title}} - {{siteUrl.description}}</h4>
                                    </div>
                                    <div [hidden]="!editMode">
                                        <md-input-container>
                                            <input mdInput type="text" [(ngModel)]="siteUrl.title" placeholder="{{resources.titlePlaceHolder}}" />
                                        </md-input-container>
                                        <md-input-container>
                                            <input mdInput type="text" [(ngModel)]="siteUrl.description" placeholder="{{resources.descriptionPlaceHolder}}" />
                                        </md-input-container>
                                    </div>
                                </div>
                                <div fxFlex>
                                    <div fxLayout="column" fxLayoutAlign="space-between stretch">
                                        <button [hidden]="editMode" md-button (click)="editMode = true" mdTooltip="{{resources.editRouteDetails}}" mdTooltipPosition="{{resources.start}}"><i class="fa icon-pencil"></i></button>
                                        <button [hidden]="!editMode" md-button (click)="editMode = false; userService.updateSiteUrl(siteUrl)" mdTooltip="{{resources.update}}" mdTooltipPosition="{{resources.start}}"><i class="fa icon-check"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div fxLayout="row">
                                <div fxFlex="75">
                                    <a href="{{userService.getUrlFromSiteUrlId(siteUrl)}}" target="_blank">{{userService.getUrlFromSiteUrlId(siteUrl)}}</a><br />
                                    {{resources.views}}: {{siteUrl.viewsCount}}<br />
                                    {{resources.lastViewed}}: {{siteUrl.lastViewed | date:'dd/MM/yyyy'}}
                                </div>
                                <div fxFlex>
                                    <div fxLayout="column" fxLayoutAlign="space-between stretch">
                                        <button md-button [ngxClipboard]="userService.getUrlFromSiteUrlId(siteUrl)" mdTooltip="{{resources.copyUrl}}" mdTooltipPosition="{{resources.start}}"><i class="fa icon-clipboard"></i></button>
                                        <button md-button (click)="editMode = false; userService.deleteSiteUrl(siteUrl)" mdTooltip="{{resources.delete}}" mdTooltipPosition="{{resources.start}}"><i class="fa icon-trash"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <br />
                </div>
                <div class="cssload-loader" [hidden]="!userService.loading">
                    <div class="cssload-inner cssload-one"></div>
                    <div class="cssload-inner cssload-two"></div>
                    <div class="cssload-inner cssload-three"></div>
                </div>
                <p [hidden]="userService.siteUrls.length != 0 || userService.loading">{{resources.noShares}}</p>
            </md-tab>
        </md-tab-group>
    </div>
    <div md-dialog-actions>
        <button md-dialog-close md-button>{{resources.close}}</button>
    </div>
</div>
