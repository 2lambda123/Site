version: 7.2.{build}
clone_depth: 1
image: Visual Studio 2017
configuration: Release
environment:
    ANDROID_HOME: C:\Program Files (x86)\Android\android-sdk\
    GRADLE_OPTS: "-Dorg.gradle.daemon=false"
    STORE_PASSWROD:
        secure: ZF3GiQxQ98B1HGKZOwlnmris5yN68mvx3UF6TVsnpws=
    PASSWROD:
        secure: mqbXr4+cn3l9YNyKhOezbA==
install:
- ps: >-
    npm install -g npm@6.2.0 --loglevel=error

    choco install gradle --version 4.9 --no-progress

    $env:Path += ";C:\ProgramData\chocolatey\lib\gradle\tools\gradle-4.9\bin"

    node --version

    npm --version

    gradle --version

    for($i=0;$i -lt 30;$i++) { $response += "y`n"};

    Invoke-Expression """$response"" | $env:ANDROID_HOME\tools\bin\sdkmanager.bat --licenses"

    Invoke-Expression """$response"" | $env:ANDROID_HOME\tools\bin\sdkmanager.bat --update | out-null"

    Invoke-Expression "$env:ANDROID_HOME\tools\bin\sdkmanager.bat ""platform-tools"" ""tools"" ""platforms;android-26"" ""build-tools;28.0.2"" ""extras;google;m2repository"" | out-null"

before_build:
- ps: dotnet restore
build:
  project: IsraelHiking.sln
  parallel: true
  verbosity: minimal
after_test:
- ps: >-
    $PostBuildTests = "$env:APPVEYOR_BUILD_FOLDER\Scripts\PostBuildTests.ps1"

    Write-Host $PostBuildTests

    & "$PostBuildTests"

    $PostBuildPackArtifacts = "$env:APPVEYOR_BUILD_FOLDER\Scripts\PostBuildPackArtifacts.ps1"

    Write-Host $PostBuildPackArtifacts

    & "$PostBuildPackArtifacts"

deploy:
- provider: GitHub
  auth_token:
    secure: UhPMkdOfJ0iYk+ZEJapaimnlsy+yXWXYzwJ7Lgj9aiMq2lj5JcUkN1UI0Q9QZru6
  repository: IsraelHikingMap/Site
  draft: true
  on:
    appveyor_repo_tag: true
