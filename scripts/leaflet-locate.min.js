/*!
Copyright (c) 2014 Dominik Moritz
This file is part of the leaflet locate control. It is licensed under the MIT license.
You can find the project at: https://github.com/domoritz/leaflet-locatecontrol
*/
(function(n,t){typeof define=="function"&&define.amd?define(["leaflet"],n):typeof exports=="object"&&(module.exports=typeof t!="undefined"&&t.L?n(L):n(require("leaflet")));typeof t!="undefined"&&t.L&&(t.L.Locate=n(L))})(function(n){return n.Control.Locate=n.Control.extend({options:{position:"topleft",drawCircle:!0,follow:!1,stopFollowingOnDrag:!1,remainActive:!1,markerClass:n.circleMarker,circleStyle:{color:"#136AEC",fillColor:"#136AEC",fillOpacity:.15,weight:2,opacity:.5},markerStyle:{color:"#136AEC",fillColor:"#2A93EE",fillOpacity:.7,weight:2,opacity:.9,radius:5},followCircleStyle:{},followMarkerStyle:{},icon:"fa fa-map-marker",iconLoading:"fa fa-spinner fa-spin",circlePadding:[0,0],metric:!0,onLocationError:function(n){alert(n.message)},onLocationOutsideMapBounds:function(n){n.stop();alert(n.options.strings.outsideMapBoundsMsg)},setView:!0,keepCurrentZoomLevel:!1,showPopup:!0,strings:{title:"Show me where I am",metersUnit:"meters",feetUnit:"feet",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{maxZoom:Infinity,watch:!0}},initialize:function(t){n.Map.addInitHook(function(){this.options.locateControl&&this.addControl(this)});for(var i in t)typeof this.options[i]=="object"?n.extend(this.options[i],t[i]):this.options[i]=t[i];n.extend(this.options.locateOptions,{setView:!1})},_activate:function(){this.options.setView&&(this._locateOnNextLocationFound=!0);this._active||this._map.locate(this.options.locateOptions);this._active=!0;this.options.follow&&this._startFollowing(this._map)},_deactivate:function(){this._map.stopLocate();this._map.off("dragstart",this._stopFollowing,this);this.options.follow&&this._following&&this._stopFollowing(this._map)},drawMarker:function(t){var i,r,u,f,e,o,s;if(this._event.accuracy===undefined&&(this._event.accuracy=0),i=this._event.accuracy,this._locateOnNextLocationFound){if(this._isOutsideMapBounds())this.options.onLocationOutsideMapBounds(this);else this.options.keepCurrentZoomLevel||!this.options.drawCircle?t.panTo([this._event.latitude,this._event.longitude]):t.fitBounds(this._event.bounds,{padding:this.options.circlePadding,maxZoom:this.options.keepCurrentZoomLevel?t.getZoom():this.options.locateOptions.maxZoom});this._locateOnNextLocationFound=!1}if(this.options.drawCircle)if(r=this._following?this.options.followCircleStyle:this.options.circleStyle,this._circle){this._circle.setLatLng(this._event.latlng).setRadius(i);for(u in r)this._circle.options[u]=r[u]}else this._circle=n.circle(this._event.latlng,i,r).addTo(this._layer);this.options.metric?(f=i.toFixed(0),e=this.options.strings.metersUnit):(f=(i*3.2808399).toFixed(0),e=this.options.strings.feetUnit);o=this._following?this.options.followMarkerStyle:this.options.markerStyle;this._marker?this.updateMarker(this._event.latlng,o):this._marker=this.createMarker(this._event.latlng,o).addTo(this._layer);s=this.options.strings.popup;this.options.showPopup&&s&&this._marker.bindPopup(n.Util.template(s,{distance:f,unit:e}))._popup.setLatLng(this._event.latlng);this._toggleContainerStyle()},createMarker:function(n,t){return this.options.markerClass(n,t)},updateMarker:function(n,t){this._marker.setLatLng(n);for(var i in t)this._marker.options[i]=t[i]},removeMarker:function(){this._layer.clearLayers();this._marker=undefined;this._circle=undefined},onAdd:function(t){var r=n.DomUtil.create("div","leaflet-control-locate leaflet-bar leaflet-control"),i;this._layer=new n.LayerGroup;this._layer.addTo(t);this._event=undefined;i={};n.extend(i,this.options.markerStyle,this.options.followMarkerStyle);this.options.followMarkerStyle=i;i={};n.extend(i,this.options.circleStyle,this.options.followCircleStyle);this.options.followCircleStyle=i;this._link=n.DomUtil.create("a","leaflet-bar-part leaflet-bar-part-single",r);this._link.href="#";this._link.title=this.options.strings.title;this._icon=n.DomUtil.create("span",this.options.icon,this._link);n.DomEvent.on(this._link,"click",n.DomEvent.stopPropagation).on(this._link,"click",n.DomEvent.preventDefault).on(this._link,"click",function(){var n=this._event===undefined||this._map.getBounds().contains(this._event.latlng)||!this.options.setView||this._isOutsideMapBounds();!this.options.remainActive&&this._active&&n?this.stop():this.start()},this).on(this._link,"dblclick",n.DomEvent.stopPropagation);return this._resetVariables(),this.bindEvents(t),r},bindEvents:function(n){n.on("locationfound",this._onLocationFound,this);n.on("locationerror",this._onLocationError,this);n.on("unload",this.stop,this)},start:function(){this._activate();this._event?this.drawMarker(this._map):this._setClasses("requesting")},stop:function(){this._deactivate();this._cleanClasses();this._resetVariables();this.removeMarker()},_onLocationError:function(n){if(n.code!=3||!this.options.locateOptions.watch){this.stop();this.options.onLocationError(n)}},_onLocationFound:function(n){this._event&&this._event.latlng.lat===n.latlng.lat&&this._event.latlng.lng===n.latlng.lng&&this._event.accuracy===n.accuracy||this._active&&(this._event=n,this.options.follow&&this._following&&(this._locateOnNextLocationFound=!0),this.drawMarker(this._map))},_startFollowing:function(){if(this._map.fire("startfollowing",this),this._following=!0,this.options.stopFollowingOnDrag)this._map.on("dragstart",this._stopFollowing,this)},_stopFollowing:function(){this._map.fire("stopfollowing",this);this._following=!1;this.options.stopFollowingOnDrag&&this._map.off("dragstart",this._stopFollowing,this);this._toggleContainerStyle()},_isOutsideMapBounds:function(){return this._event===undefined?!1:this._map.options.maxBounds&&!this._map.options.maxBounds.contains(this._event.latlng)},_toggleContainerStyle:function(){this._container&&(this._following?this._setClasses("following"):this._setClasses("active"))},_setClasses:function(t){t=="requesting"?(n.DomUtil.removeClasses(this._container,"active following"),n.DomUtil.addClasses(this._container,"requesting"),n.DomUtil.removeClasses(this._icon,this.options.icon),n.DomUtil.addClasses(this._icon,this.options.iconLoading)):t=="active"?(n.DomUtil.removeClasses(this._container,"requesting following"),n.DomUtil.addClasses(this._container,"active"),n.DomUtil.removeClasses(this._icon,this.options.iconLoading),n.DomUtil.addClasses(this._icon,this.options.icon)):t=="following"&&(n.DomUtil.removeClasses(this._container,"requesting"),n.DomUtil.addClasses(this._container,"active following"),n.DomUtil.removeClasses(this._icon,this.options.iconLoading),n.DomUtil.addClasses(this._icon,this.options.icon))},_cleanClasses:function(){n.DomUtil.removeClass(this._container,"requesting");n.DomUtil.removeClass(this._container,"active");n.DomUtil.removeClass(this._container,"following");n.DomUtil.removeClasses(this._icon,this.options.iconLoading);n.DomUtil.addClasses(this._icon,this.options.icon)},_resetVariables:function(){this._active=!1;this._locateOnNextLocationFound=this.options.setView;this._following=!1}}),n.control.locate=function(t){return new n.Control.Locate(t)},function(){var t=function(t,i,r){r=r.split(" ");r.forEach(function(r){n.DomUtil[t].call(this,i,r)})};n.DomUtil.addClasses=function(n,i){t("addClass",n,i)};n.DomUtil.removeClasses=function(n,i){t("removeClass",n,i)}}(),n.Control.Locate},window);
//# sourceMappingURL=leaflet-locate.min.js.map
